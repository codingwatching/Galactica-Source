!function(t){function e(o){if(i[o])return i[o].exports;var a=i[o]={i:o,l:!1,exports:{}};return t[o].call(a.exports,a,a.exports,e),a.l=!0,a.exports}var i={};e.m=t,e.c=i,e.d=function(t,i,o){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:o})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=0)}([function(t,e,i){"use strict";function o(){c.render(),requestAnimationFrame(o)}var a=i(1),r=document.getElementById("canvas"),s=new BABYLON.Engine(r),n=BABYLON.Vector3,l=BABYLON.Color3,h=BABYLON.Color4,c=new BABYLON.Scene(s);!function(t){function e(e,i,o){var a=BABYLON.Mesh.CreateBox("box1",1,t);a.position=e.subtractInPlace(i.scale(.5)),a.scaling=i,a.material=o}t.clearColor=new BABYLON.Color3(.7,.8,.9);var i=new BABYLON.ArcRotateCamera("camera",-1,1.4,90,new n(0,10,0),t);new BABYLON.HemisphericLight("light",new n(.1,1,.3),t),i.attachControl(r,!0);var o=BABYLON.Mesh.CreateGround("ground",80,80,1,t);o.material=new BABYLON.StandardMaterial("groundMat",t),o.material.diffuseColor=new l(.7,.7,.7);var a=new BABYLON.StandardMaterial("wallmat",t);a.diffuseColor=new l(.8,.6,.6);var s=new BABYLON.StandardMaterial("windowmat",t);s.diffuseColor=new l(.2,.2,.8),s.alpha=.4,e(new n(17,30,-30),new n(2,30,1),a),e(new n(-15,30,-30),new n(2,30,1),a),e(new n(15,30,-30),new n(30,5,1),a),e(new n(15,5,-30),new n(30,5,1),a),e(new n(15,25,-30),new n(30,20,1),s)}(c),function(t){var e=new h(1,1,1,1),i=[0,1],o=[0,1],r=new a(2e3,300,t,e,i,o),s=new BABYLON.Texture("puff.png",t,!0,!1,1);r.setTexture(s),r.gravity=-5,r.setAlphaRange(1,0),r.setColorRange(l.Red(),l.Green()),r.setSizeRange(1,.5),r.mesh.position.y=2,r.initParticle=function(t){t.position.x=2*Math.random()-1,t.position.y=2*Math.random()-1,t.position.z=2*Math.random()-1,t.velocity.x=20*Math.random()-10,t.velocity.y=10*Math.random()+5,t.velocity.z=20*Math.random()-10,t.size=3*Math.random()+3,t.age=0,t.lifetime=2*Math.random()+1},r.start(),window.mps=r,window.scene=t}(c),o()},function(t,e){function i(){this.position=y.Zero(),this.velocity=y.Zero(),this.size=1,this.age=0,this.lifetime=1}function o(t){t.position.copyFromFloats(0,0,0),t.velocity.x=5*(Math.random()-.5),t.velocity.y=.5*Math.random()*5+2,t.velocity.z=5*(Math.random()-.5),t.size=1*Math.random(),t.age=0,t.lifetime=2}function a(t,e,a,r,s,n){if(t||(t=100),isNaN(e)&&(e=0),!a)throw"Invalid scene passed to mesh-particle-system";r=r||{r:1,g:1,b:1,a:1},s=s||[0,1],n=n||[0,1],this.capacity=t,this.rate=e,this.mesh=new BABYLON.Mesh("MPS-mesh",a),this.material=null,this.texture=null,this.gravity=-1,this.friction=1,this.fps=60,this.disposeOnEmpty=!1,this.stopOnEmpty=!1,this.parent=null,this.onDispose=null,this._scene=a,this._alive=0,this._data=new Float32Array(t*g),this._dummyParticle=new i,this._color0=new BABYLON.Color4(r.r,r.g,r.b,r.a),this._color1=new BABYLON.Color4(r.r,r.g,r.b,r.a),this._updateColors=!1,this._size0=1,this._size1=1,this._positions=[],this._colors=[],this._playing=!1,this._disposed=!1,this._lastPos=y.Zero(),this._startingThisFrame=!1,this._toEmit=0,this._createdOwnMaterial=!1,this._needsColorUpdate=!0;for(var l=this._positions,h=this._colors,c=[],u=[],p=[s[0],n[1],s[1],n[1],s[1],n[0],s[0],n[0]],m=0;m<t;m++){l.push(0,0,0,0,0,0,0,0,0,0,0,0),c.push(4*m,4*m+1,4*m+2),c.push(4*m,4*m+2,4*m+3);for(var d=0;d<8;d++)u.push(p[d]);for(var _=0;_<4;_++)h.push(r.r,r.g,r.b,r.a)}var f=new BABYLON.VertexData;f.positions=l,f.indices=c,f.uvs=u,f.colors=h,f.applyToMesh(this.mesh,!0),this.initParticle=o;var v=this;this.curriedAnimate=function(){v.animate(1/v.fps)}}function r(t){this._needsColorUpdate=!1;var e=t._color0,i=t._color1,o=!(s(e.a,1)&&s(e.a,i.a)),a=!(s(e.r,i.r)&&s(e.g,i.g)&&s(e.b,i.b));t._updateColors=o||a,t.mesh.hasVertexAlpha=o,t.material&&(a||o?(t.material.diffuseTexture=null,t.material.ambientTexture=t.texture,t.material.opacityTexture=t.texture,t.material.diffuseColor=v.White(),t.material.useAlphaFromDiffuseTexture=!0,t.texture&&(t.texture.hasAlpha=!1)):(t.material.diffuseTexture=t.texture,t.material.ambientTexture=null,t.material.opacityTexture=null,t.material.diffuseColor=new v(e.r,e.g,e.b),t.material.useAlphaFromDiffuseTexture=!1,t.texture&&(t.texture.hasAlpha=!0)))}function s(t,e){return Math.abs(t-e)<1e-5}function n(t){for(var e=t._dummyParticle,i=0,o=new y(1/0,1/0,1/0),a=new y(-1/0,-1/0,-1/0),r=t.gravity/2,s=0;s<30;++s){t.initParticle(e),l(o,a,e.position.x,e.position.y,e.position.z);var n=e.lifetime;l(o,a,e.position.x+n*e.velocity.x,e.position.y+n*e.velocity.y+n*n*r,e.position.z+n*e.velocity.z),i=Math.max(i,e.size)}o.subtractFromFloatsToRef(i,i,i,o),a.subtractFromFloatsToRef(-i,-i,-i,a),t.mesh._boundingInfo=new BABYLON.BoundingInfo(o,a)}function l(t,e,i,o,a){i<t.x?t.x=i:i>e.x&&(e.x=i),o<t.y?t.y=o:o>e.y&&(e.y=o),a<t.z?t.z=a:a>e.z&&(e.z=a)}function h(t){var e=t._dummyParticle;t.initParticle(e);var i=t._data,o=t._alive*g;i[o]=e.position.x,i[o+1]=e.position.y,i[o+2]=e.position.z,i[o+3]=e.velocity.x,i[o+4]=e.velocity.y,i[o+5]=e.velocity.z,i[o+6]=e.size,i[o+7]=e.age,i[o+8]=e.lifetime,t._alive+=1}function c(t,e){for(var i=t._data,o=(t._alive-1)*g,a=e*g,r=0;r<g;++r)i[a+r]=i[o+r];t._alive-=1}function u(t,e){t._toEmit+=e;var i=Math.floor(t._toEmit);t._toEmit-=i;var o=t._alive+i;for(o>t.capacity&&(o=t.capacity);t._alive<o;)h(t)}function p(t,e){for(var i=t.gravity*e,o=t._data,a=t.friction,r=0,s=0;s<t._alive;++s){o[r+4]+=i,o[r+3]*=a,o[r+4]*=a,o[r+5]*=a,o[r]+=o[r+3]*e,o[r+1]+=o[r+4]*e,o[r+2]+=o[r+5]*e;var n=o[r+7]+e;n>o[r+8]?(c(t,s),s--):(o[r+7]=n,r+=g)}}function m(t){if(t.parent){var e=t.parent.absolutePosition;t._startingThisFrame&&(e=t.parent.getAbsolutePosition(),t._startingThisFrame=!1),t.mesh.position.copyFrom(e)}var i=t.mesh.position.x-t._lastPos.x,o=t.mesh.position.y-t._lastPos.y,a=t.mesh.position.z-t._lastPos.z;if(t._lastPos.copyFrom(t.mesh.position),!(Math.abs(i)+Math.abs(o)+Math.abs(a)<.001))for(var r=t._alive,s=t._data,n=0;n<r;n++){var l=n*g;s[l]-=i,s[l+1]-=o,s[l+2]-=a}}function d(t){var e=t._positions,i=t._data,o=t._scene.activeCamera,a=BABYLON.Matrix.Identity();BABYLON.Matrix.LookAtLHToRef(o.globalPosition,t.mesh.position,y.Up(),a),a.m[12]=a.m[13]=a.m[14]=0,a.invert();for(var r=a.m,s=t._alive,n=t._size0,l=t._size1-n,h=0;h<s;h++)for(var c=h*g,u=i[c+7]/i[c+8],p=i[c+6]*(n+l*u)/2,m=12*h,d=0;d<4;d++){var _=1===d||2===d?p:-p,f=d>1?p:-p,v=_*r[3]+f*r[7]+r[15];e[m]=i[c]+(_*r[0]+f*r[4])/v,e[m+1]=i[c+1]+(_*r[1]+f*r[5])/v,e[m+2]=i[c+2]+(_*r[2]+f*r[6])/v,m+=3}t.mesh.updateVerticesData(BABYLON.VertexBuffer.PositionKind,e,!1,!1)}function _(t){for(var e=t._alive,i=t._data,o=t._colors,a=t._color0.r,r=t._color0.g,s=t._color0.b,n=t._color0.a,l=t._color1.r-a,h=t._color1.g-r,c=t._color1.b-s,u=t._color1.a-n,p=0;p<e;p++)for(var m=p*g,d=i[m+7]/i[m+8],_=a+l*d,f=r+h*d,y=s+c*d,v=n+u*d,B=16*p,x=0;x<4;x++)o[B]=_,o[B+1]=f,o[B+2]=y,o[B+3]=v,B+=4;t.mesh.updateVerticesData(BABYLON.VertexBuffer.ColorKind,o,!1,!1)}function f(t){t.stop(),t._createdOwnMaterial&&(t.material.ambientTexture=null,t.material.opacityTexture=null,t.material.diffuseTexture=null,t.material.dispose(!1,!1)),t.material=null,t.mesh.geometry.dispose(),t.mesh.dispose(),t.mesh=null,t.texture=null,t.curriedAnimate=null,t.initParticle=null,t._scene=null,t._dummyParticle=null,t._color0=null,t._color1=null,t._data=null,t._positions.length=0,t._colors.length=0,t._positions=null,t._colors=null,t.parent=null,t._disposed=!0}t.exports=a;var y=BABYLON.Vector3,v=BABYLON.Color3,B=a;B.prototype.start=function(){if(!this._playing){if(this._disposed)throw new Error("Already disposed");this._scene.registerBeforeRender(this.curriedAnimate),n(this),this._playing=!0,this._startingThisFrame=!0}},B.prototype.stop=function(){this._playing&&(this._scene.unregisterBeforeRender(this.curriedAnimate),this._playing=!1)},B.prototype.setTexture=function(t,e){e?(this.material&&this._createdOwnMaterial&&this.material.dispose(!1,!1),this.material=e,this._createdOwnMaterial=!1):this.material||(this.material=new BABYLON.StandardMaterial("MPS-mat",this._scene),this.material.specularColor=v.Black(),this.material.checkReadyOnlyOnce=!0,this._createdOwnMaterial=!0),this.mesh.material=this.material,this.texture=t,this._needsColorUpdate=!0},B.prototype.setAlphaRange=function(t,e){this._color0.a=t,this._color1.a=e,this._needsColorUpdate=!0},B.prototype.setColorRange=function(t,e){this._color0.r=t.r,this._color0.g=t.g,this._color0.b=t.b,this._color1.r=e.r,this._color1.g=e.g,this._color1.b=e.b,this._needsColorUpdate=!0},B.prototype.setSizeRange=function(t,e){this._size0=t,this._size1=e},B.prototype.emit=function(t){this.start(),this._toEmit+=t},B.prototype.dispose=function(){this.onDispose&&this.onDispose(),f(this)};var g=9;B.prototype.animate=function(t){this._needsColorUpdate&&r(this),t>.1&&(t=.1),m(this),u(this,this.rate*t),p(this,t),d(this),this._updateColors&&_(this),this.mesh.subMeshes[0].indexCount=6*this._alive,0===this._alive&&0===this.rate&&(this.disposeOnEmpty?this.dispose():this.stopOnEmpty&&this.stop())}}]);