/*! Sifrr.Storage v0.0.5 - sifrr project | MIT licensed | https://github.com/sifrr/sifrr */
this.Sifrr=this.Sifrr||{},this.Sifrr.Storage=function(){"use strict";const t=Object.prototype.toString,e="~SS%l3g5k3~";var r=class{static parse(t){let r=t;if("string"==typeof t)try{r=t=JSON.parse(t)}catch(t){}if("string"==typeof t&&t.indexOf(e)>0){const[s,i,n]=t.split(e);r="ArrayBuffer"===s?new window.Uint8Array(i.split(",")).buffer:"Blob"===s?function(t,e){return new Blob([new window.Uint8Array(t.split(",")).buffer],{type:e})}(n,i):new window[s](i.split(","))}else if(Array.isArray(t))r=[],t.forEach((t,e)=>{r[e]=this.parse(t)});else if("object"==typeof t){if(null===t)return null;r={};for(const e in t)r[e]=this.parse(t[e])}return r}static stringify(r){if("object"!=typeof r)return JSON.stringify(r);if(null===r)return"null";if(Array.isArray(r))return JSON.stringify(r.map(t=>this.stringify(t)));const s=t.call(r).slice(8,-1);if("Object"===s){let t={};for(let e in r)t[e]=this.stringify(r[e]);return JSON.stringify(t)}return"ArrayBuffer"===s?r=new window.Uint8Array(r):"Blob"===s&&(r=r.type+e+function(t){const e=URL.createObjectURL(t),r=new XMLHttpRequest;r.open("GET",e,!1),r.send(),URL.revokeObjectURL(e);const s=new Uint8Array(r.response.length);for(let t=0;t<r.response.length;++t)s[t]=r.response.charCodeAt(t);return s.toString()}(r)),s+e+r.toString()}};const s={}.constructor;var i=class{constructor(t={}){this._options=t,this.name=this._options.name,this.version=this._options.version,this.tableName=this.name+this.version,this.description=this._options.description,this.type=this.constructor.type}_parseKeyValue(t,e){if(void 0===e){if(Array.isArray(t))return t;if("string"==typeof t)return[t];if(t.constructor===s)return t;throw Error("Invalid Key")}if("string"==typeof t){let r={};return r[t]=e,r}throw Error("Invalid Key")}_select(t){return this.all().then(e=>{let r={};return t.forEach(t=>r[t]=e[t]),r})}_upsert(t){let e=this.table;for(let r in t)e[r]=t[r];this.table=e}_delete(t){let e=this.table;t.forEach(t=>delete e[t]),this.table=e}_clear(){this.table={}}_isEqual(t,e){return this.tableName==t.name+t.version&&this.type==e}isSupported(t=!0){return!(!t||"undefined"!=typeof window&&"undefined"!=typeof document)||!(!window||void 0===this.store)}keys(){return this.all().then(t=>Object.keys(t))}all(){return Promise.resolve(this._parsedData())}get(t){return Promise.resolve(this._select(this._parseKeyValue(t)))}set(t,e){return Promise.resolve(this._upsert(this._parseKeyValue(t,e)))}del(t){return Promise.resolve(this._delete(this._parseKeyValue(t)))}clear(){return Promise.resolve(this._clear())}static stringify(t){return r.stringify(t)}static parse(t){return r.parse(t)}};var n=class extends i{constructor(t){super(t)}_parsedData(){return this._tx("readonly","getAllKeys").then(this._select.bind(this))}_select(t){const e={},r=[];return t.forEach(t=>r.push(this._tx("readonly","get",t).then(r=>e[t]=r))),Promise.all(r).then(()=>e)}_upsert(t){const e=[];for(let r in t)e.push(this._tx("readwrite","put",t[r],r));return Promise.all(e)}_delete(t){const e=[];return t.forEach(t=>e.push(this._tx("readwrite","delete",t))),Promise.all(e)}_clear(){return this._tx("readwrite","clear")}_tx(t,e,r,s){const i=this;return this._store=this._store||this.createStore(i.tableName),this._store.then(n=>new Promise((o,a)=>{const c=n.transaction(i.tableName,t).objectStore(i.tableName),l=c[e].call(c,r,s);l.onsuccess=t=>o(t.target.result),l.onerror=t=>a(t.error)}))}get store(){return window.indexedDB}createStore(t){return new Promise((e,r)=>{const s=this.store.open(t,1);s.onupgradeneeded=e=>{e.target.result.createObjectStore(t)},s.onsuccess=()=>e(s.result),s.onerror=()=>r(s.error)})}static get type(){return"indexeddb"}};var o=class extends i{constructor(t){super(t),this.createStore()}_parsedData(){return this.execSql("SELECT key, value FROM ".concat(this.tableName))}_select(t){const e=t.map(()=>"?").join(", ");return this.execSql("SELECT key, value FROM ".concat(this.tableName," WHERE key in (").concat(e,")"),t)}_upsert(t){this.store.transaction(e=>{for(let r in t)e.executeSql("INSERT OR REPLACE INTO ".concat(this.tableName,"(key, value) VALUES (?, ?)"),[r,this.constructor.stringify(t[r])])})}_delete(t){const e=t.map(()=>"?").join(", ");return this.execSql("DELETE FROM ".concat(this.tableName," WHERE key in (").concat(e,")"),t)}_clear(){return this.execSql("DELETE FROM ".concat(this.tableName))}get store(){return window.openDatabase("ss",1,this._options.description,this._options.size)}createStore(){if(window&&"function"==typeof window.openDatabase)return this.execSql("CREATE TABLE IF NOT EXISTS ".concat(this.tableName," (key unique, value)"))}execSql(t,e=[]){const r=this;return new Promise(s=>{r.store.transaction(function(i){i.executeSql(t,e,(t,e)=>{s(r.parse(e))})})})}parse(t){const e={},r=t.rows.length;for(let s=0;s<r;s++)e[t.rows.item(s).key]=this.constructor.parse(t.rows.item(s).value);return e}static get type(){return"websql"}};var a=class extends i{constructor(t){super(t)}_parsedData(){return this._select(Object.keys(this.store).map(t=>{if(0===t.indexOf(this.tableName))return t.slice(this.tableName.length+1)}).filter(t=>void 0!==t))}_select(t){const e={};return t.forEach(t=>{const r=this.constructor.parse(this.store.getItem(this.tableName+"/"+t));null!==r&&(e[t]=r)}),e}_upsert(t){for(let e in t)this.store.setItem(this.tableName+"/"+e,this.constructor.stringify(t[e]));return!0}_delete(t){return t.map(t=>this.store.removeItem(this.tableName+"/"+t))}_clear(){return Object.keys(this.store).forEach(t=>{0===t.indexOf(this.tableName)&&this.store.removeItem(t)}),!0}get store(){return window.localStorage}static get type(){return"localstorage"}};const c=new Date(0).toUTCString(),l="%3D",u=new RegExp(l,"g");var h=class extends i{constructor(t){super(t)}_parsedData(){let t=this.store,e={};return t.split("; ").forEach(t=>{let[r,s]=t.split("=");0===r.indexOf(this.tableName)&&(e[r.slice(this.tableName.length+1)]=this.constructor.parse(s.replace(u,"=")))}),e}_upsert(t){for(let e in t)this.store="".concat(this.tableName,"/").concat(e,"=").concat(this.constructor.stringify(t[e]).replace(/=/g,l),"; path=/");return!0}_clear(){this.store.split("; ").forEach(t=>{const e=t.split("=")[0];0===e.indexOf(this.tableName)&&(this.store="".concat(e,"=; expires=").concat(c,"; path=/"))})}get store(){return document.cookie}set store(t){document.cookie=t}static get type(){return"cookies"}};var p=class extends i{constructor(t,e={}){super(t),this.table=i.parse(e)}_parsedData(){return this.table}get store(){return this.table}static get type(){return"jsonstorage"}};let f={};f[n.type]=n,f[o.type]=o,f[a.type]=a,f[h.type]=h,f[p.type]=p;var d=f;class y{constructor(t){return t="string"==typeof t?{priority:[t]}:t||{},this._options=Object.assign(this.constructor.defaultOptions,t),this.storage}get storage(){let t=this.supportedStore();if(void 0===t)throw Error("No available storage supported in this browser");let e=this.constructor._matchingInstance(this._options,t.type);if(e)return e;{let e=new t(this._options);return this.constructor._add(e),e}}get priority(){return this._options.priority.concat(["indexeddb","websql","localstorage","cookies","jsonstorage"])}supportedStore(){for(let t=0;t<this.priority.length;t++){let e=this.constructor.availableStores[this.priority[t]];if(e&&new e(this._options).isSupported())return e}}static _matchingInstance(t,e){let r,s=this.all,i=s.length;for(r=0;r<i;r++)if(s[r]._isEqual(t,e))return s[r];return!1}static _add(t){this.all.push(t)}static get defaultOptions(){return{priority:[],name:"SifrrStorage",version:1,description:"Sifrr Storage",size:5242880}}static json(t){return new p({},t)}}return y.availableStores=d,y.all=[],y}();
/*! (c) @aadityataparia */
